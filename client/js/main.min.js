const ChartConfig={labels:['Cores','Logical Processors','Architecture'],datasets:{bar:{label:'System Score',backgroundColors:['#003087','#005a9e','#0078d4'],borderColors:['#002060','#003c6e','#004f8c'],borderWidth:1},radar:{label:'System Specifications',backgroundColor:'rgba(0, 48, 135, 0.2)',borderColor:'#003087',borderWidth:2,pointBackgroundColor:'#003087',pointBorderColor:'#ffffff',pointRadius:4}},maxValue:9.9},SystemInfoApp={elements:{osInfo:document.getElementById('os-info'),osLogo:document.getElementById('os-logo'),errorNote:document.getElementById('error-note'),detailsTableBody:document.getElementById('details-table-body'),windowsExperienceIndexTableBody:document.getElementById('windows-experience-index-table-body'),container:document.querySelector('.container'),loadingOverlay:document.querySelector('.loading-overlay'),tabs:document.querySelectorAll('.tab'),tabContents:document.querySelectorAll('.tab-content')},minLoadingDuration:1000,initialize(){this.setupTabSwitching();this.loadSystemData();},setupTabSwitching(){this.elements.tabs.forEach(tab=>{tab.addEventListener('click',()=>{this.elements.tabs.forEach(t=>t.classList.remove('active'));this.elements.tabContents.forEach(tc=>tc.classList.remove('active'));tab.classList.add('active');document.getElementById(tab.dataset.tab).classList.add('active');});});},async loadSystemData(){const startTime=Date.now();try{const[osResponse,systemResponse]=await this.fetchData();console.log('OS API Response:',{status:osResponse.status,os:osResponse.data.os});console.log('System API Response - Architecture:',systemResponse.arch);const elapsedTime=Date.now()-startTime;const remainingTime=this.minLoadingDuration-elapsedTime;setTimeout(()=>{this.renderData(osResponse,systemResponse);this.hideLoadingOverlay()},Math.max(0,remainingTime));}catch(error){this.handleError(error,startTime);}},async fetchData(){const osResponse=await fetch('http://localhost:8080/os');if(!osResponse.ok)throw new Error(`OS API failed with status: ${osResponse.status}`);const systemResponse=await fetch('http://localhost:8080/sys');if(!systemResponse.ok)throw new Error(`System API failed with status: ${systemResponse.status}`);return[{status:osResponse.status,data:await osResponse.json()},await systemResponse.json()];},renderData(osResponse,systemResponse){this.renderOperatingSystemInfo(osResponse);this.renderSystemDetails(systemResponse);this.renderChartsAndEvaluation(systemResponse);},renderOperatingSystemInfo({status,data:{os}}){this.elements.osInfo.innerHTML=`Operating System: ${os}`;if(status===200&&os==='Windows'){console.log('Displaying Windows logo');this.elements.osLogo.style.display='block'}else console.log('Windows logo not displayed - OS:',os,'Status:',status);},renderSystemDetails(r){this.elements.detailsTableBody.innerHTML=this.generateSystemDetailsRows(r).join('');},generateSystemDetailsRows(r){const rows=[];if(r.os==='Windows'){rows.push(this.createTableRow('Architecture',r.arch));rows.push(this.createTableRow('Processor',r.processorArchitecture));rows.push(this.createTableRow('Cores',r.numberOfCores));rows.push(this.createTableRow('Logical Processors',r.numberOfLogicalProcessors));}else if(r.os==='Linux'||r.os==='macOS'){rows.push(this.createTableRow('System',r.sysname));rows.push(this.createTableRow('Version',r.release));rows.push(this.createTableRow('Machine',r.machine));rows.push(this.createTableRow('Cores',r.numberOfCores));}rows.push(this.createTableRow('Date and Time',r.datetime));return rows;},createTableRow(e,t,n=''){return`<tr${n?` class="${n}"`:''}><th>${e}</th><td>${t}</td></tr>`;},renderChartsAndEvaluation(r){const d=this.calculateChartData(r);this.renderWindowsExperienceIndexTable(d);this.renderBarChart(d);this.renderRadarChart(d);},calculateChartData(r){const a=(r.arch||'').toLowerCase(),s=this.calculateArchitectureScore(a);if(!['x64','amd64','x86_64','9','arm64'].includes(a))this.elements.errorNote.innerHTML=`Warning: Unrecognized architecture '${r.arch}'. Defaulting to score 4.5.`;console.log('Calculated Architecture Score:',s);return{labels:ChartConfig.labels,datasets:[{label:ChartConfig.datasets.bar.label,data:[Math.min((r.numberOfCores/8)*ChartConfig.maxValue,ChartConfig.maxValue)||1.0,Math.min((r.numberOfLogicalProcessors/16)*ChartConfig.maxValue,ChartConfig.maxValue)||(r.numberOfCores/8)*ChartConfig.maxValue||1.0,s],backgroundColor:ChartConfig.datasets.bar.backgroundColors,borderColor:ChartConfig.datasets.bar.borderColors,borderWidth:ChartConfig.datasets.bar.borderWidth}]};},calculateArchitectureScore(e){return['x64','amd64','x86_64','9'].includes(e)?8.0:e==='arm64'?6.5:4.5},renderWindowsExperienceIndexTable(r){const rows=r.datasets[0].data.map((score,i)=>this.createTableRow(r.labels[i],score.toFixed(1)));const baseScore=Number(Math.min(...r.datasets[0].data).toFixed(1));const rating=this.calculateRating(baseScore);console.log('Base Score:',baseScore,'Rating:',rating);rows.push(this.createTableRow('Base Score',baseScore.toFixed(1),'base-score'));rows.push(this.createTableRow('Rating',rating,'rating'));this.elements.windowsExperienceIndexTableBody.innerHTML=rows.join('');},calculateRating(e){return e>=7.0?'Excellent':e>=4.9?'Good':e>=3.0?'Fair':'Poor'},renderBarChart(r){const c=document.getElementById('bar-chart').getContext('2d');c.canvas.width=400;c.canvas.height=200;this.drawBarChartGrid(c);this.drawBarChartBars(c,r);this.drawBarChartAxes(c);},drawBarChartGrid(c){const w=c.canvas.width,h=c.canvas.height;for(let i=0;i<=5;i++){const y=h-(i*(h-40)/5)-20;c.beginPath();c.moveTo(30,y);c.lineTo(w-10,y);c.strokeStyle='#e0e0e0';c.stroke();c.fillStyle='#333';c.font='12px Segoe UI';c.textAlign='right';c.fillText((i*2).toFixed(1),25,y+5);} },drawBarChartBars(c,r){const w=c.canvas.width,h=c.canvas.height,barWidth=80,scaleY=(h-40)/ChartConfig.maxValue,barSpacing=20; r.datasets[0].data.forEach((v,i)=>{const x=50+i*(barWidth+barSpacing),barHeight=v*scaleY;c.fillStyle=r.datasets[0].backgroundColor[i];c.fillRect(x,h-barHeight-20,barWidth,barHeight);c.strokeStyle=r.datasets[0].borderColor[i];c.strokeRect(x,h-barHeight-20,barWidth,barHeight);c.fillStyle='#333';c.font='12px Segoe UI';c.textAlign='center';c.fillText(r.labels[i],x+barWidth/2,h-5);c.fillText(v.toFixed(1),x+barWidth/2,h-barHeight-25);});},drawBarChartAxes(c){const w=c.canvas.width,h=c.canvas.height;c.beginPath();c.moveTo(30,h-20);c.lineTo(w-10,h-20);c.moveTo(30,h-20);c.lineTo(30,20);c.strokeStyle='#b0b0b0';c.stroke();},renderRadarChart(r){const c=document.getElementById('radar-chart').getContext('2d');c.canvas.width=200;c.canvas.height=200;const radarData=this.transformToRadarData(r);this.drawRadarChartGrid(c,radarData);this.drawRadarChartAxes(c,radarData);this.drawRadarChartData(c,radarData);},transformToRadarData(r){return{labels:r.labels,datasets:[{label:ChartConfig.datasets.radar.label,data:r.datasets[0].data.map(score=>score/ChartConfig.maxValue*100),backgroundColor:ChartConfig.datasets.radar.backgroundColor,borderColor:ChartConfig.datasets.radar.borderColor,borderWidth:ChartConfig.datasets.radar.borderWidth,pointBackgroundColor:ChartConfig.datasets.radar.pointBackgroundColor,pointBorderColor:ChartConfig.datasets.radar.pointBorderColor,pointRadius:ChartConfig.datasets.radar.pointRadius}]};},drawRadarChartGrid(c,d){const w=c.canvas.width,h=c.canvas.height,centerX=w/2,centerY=h/2,radius=80,numPoints=d.labels.length;for(let r2=20;r2<=100;r2+=20){c.beginPath();for(let i=0;i<numPoints;i++){const angle=(Math.PI*2*i)/numPoints-Math.PI/2,x=centerX+Math.cos(angle)*r2,y=centerY+Math.sin(angle)*r2;i===0?c.moveTo(x,y):c.lineTo(x,y);} c.closePath();c.strokeStyle='#e0e0e0';c.stroke();}} ,drawRadarChartAxes(c,d){const w=c.canvas.width,h=c.canvas.height,centerX=w/2,centerY=h/2,radius=80,numPoints=d.labels.length;for(let i=0;i<numPoints;i++){const angle=(Math.PI*2*i)/numPoints-Math.PI/2;c.beginPath();c.moveTo(centerX,centerY);c.lineTo(centerX+Math.cos(angle)*radius,centerY+Math.sin(angle)*radius);c.strokeStyle='#b0b0b0';c.stroke();c.fillStyle='#333';c.font='10px Segoe UI';c.textAlign='center';c.textBaseline='middle';const labelX=centerX+Math.cos(angle)*(radius+15),labelY=centerY+Math.sin(angle)*(radius+15);c.fillText(d.labels[i],labelX,labelY);} },drawRadarChartData(c,d){const w=c.canvas.width,h=c.canvas.height,centerX=w/2,centerY=h/2,radius=80,numPoints=d.labels.length; c.beginPath();d.datasets[0].data.forEach((v,i)=>{const angle=(Math.PI*2*i)/numPoints-Math.PI/2,r=(v/100)*radius,x=centerX+Math.cos(angle)*r,y=centerY+Math.sin(angle)*r;i===0?c.moveTo(x,y):c.lineTo(x,y);c.fillStyle=d.datasets[0].pointBackgroundColor;c.beginPath();c.arc(x,y,d.datasets[0].pointRadius,0,Math.PI*2);c.fill();c.strokeStyle=d.datasets[0].pointBorderColor;c.stroke();});c.closePath();c.fillStyle=d.datasets[0].backgroundColor;c.fill();c.strokeStyle=d.datasets[0].borderColor;c.stroke();c.fillStyle='#333';c.font='10px Segoe UI';d.datasets[0].data.forEach((v,i)=>{const angle=(Math.PI*2*i)/numPoints-Math.PI/2,r=(v/100)*radius+15,x=centerX+Math.cos(angle)*r,y=centerY+Math.sin(angle)*r;c.fillText(`${Math.round(v)}%`,x,y);});},hideLoadingOverlay(){this.elements.loadingOverlay.style.display='none';this.elements.container.classList.add('loaded');},handleError(e,s){console.error('Error loading data:',e.message);console.error('Error stack:',e.stack);console.log('Entering catch block, hiding overlay after delay');const elapsed=Date.now()-s;const remaining=this.minLoadingDuration-elapsed;setTimeout(()=>{this.hideLoadingOverlay();this.elements.errorNote.innerHTML=`Error: Failed to load system data. ${e.message}`;},Math.max(0,remaining));}};SystemInfoApp.initialize();
